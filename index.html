<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏°‡∏∑‡∏≠‡∏ï‡∏£‡∏ß‡∏à‡∏ã‡πà‡∏≠‡∏° API (V3)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;600&display=swap" rel="stylesheet">
    <style> body { font-family: 'Sarabun', sans-serif; } </style>
</head>
<body class="bg-gray-100 p-4">

    <div class="max-w-md mx-auto bg-white rounded-lg shadow-lg overflow-hidden">
        <div class="bg-indigo-600 p-4 text-white">
            <h1 class="text-xl font-bold">üõ†Ô∏è Diagnostics Tool V3</h1>
            <p class="text-sm opacity-80">‡πÅ‡∏Å‡πâ‡∏õ‡∏±‡∏ç‡∏´‡∏≤ 'undefined drive'</p>
        </div>

        <div class="p-6 space-y-4">
            
            <div class="border-b pb-4">
                <h3 class="font-bold text-gray-700 mb-2">1. ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÑ‡∏•‡∏ö‡∏£‡∏≤‡∏£‡∏µ (Library)</h3>
                <div id="libStatus" class="text-sm text-orange-500">‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</div>
            </div>

            <div class="border-b pb-4">
                <h3 class="font-bold text-gray-700 mb-2">2. ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏ï‡∏±‡∏ß‡∏ï‡∏ô (Auth)</h3>
                <button id="authBtn" class="bg-indigo-600 text-white px-4 py-2 rounded shadow hover:bg-indigo-700 w-full mb-2" disabled>
                    ‡∏£‡∏≠‡πÑ‡∏•‡∏ö‡∏£‡∏≤‡∏£‡∏µ...
                </button>
                <div id="authStatus" class="text-sm p-2 bg-gray-50 rounded hidden"></div>
            </div>

            <div>
                <h3 class="font-bold text-gray-700 mb-2">3. ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (API Call)</h3>
                <button id="apiBtn" class="bg-gray-400 text-white px-4 py-2 rounded shadow w-full mb-2 cursor-not-allowed" disabled>
                    ‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô...
                </button>
                
                <!-- ‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå -->
                <div id="resultArea" class="hidden mt-4">
                    <p class="font-bold text-sm mb-1">‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö:</p>
                    <div id="logContent" class="text-xs font-mono p-3 bg-slate-900 text-green-400 rounded break-words whitespace-pre-wrap"></div>
                </div>
            </div>

        </div>
    </div>

    <script async defer src="https://apis.google.com/js/api.js" onload="gapiLoaded()"></script>
    <script async defer src="https://accounts.google.com/gsi/client" onload="gisLoaded()"></script>

    <script>
        // ==========================================
        const CLIENT_ID = '395031237674-6j28i27or4lk6t3m342srbefukr1fp1d.apps.googleusercontent.com';
        const API_KEY = 'AIzaSyANFH1JUJ8Y29ImxTYwBdSV6V7-xWfHd90'; 
        // ==========================================

        let tokenClient;

        function log(msg, isError = false) {
            const area = document.getElementById('resultArea');
            const content = document.getElementById('logContent');
            area.classList.remove('hidden');
            
            if (typeof msg === 'object') {
                if (msg.result && msg.result.error) {
                    msg = `Google API Error:\nCode: ${msg.result.error.code}\nMessage: ${msg.result.error.message}\nDetails: ${JSON.stringify(msg.result.error.errors, null, 2)}`;
                } else if (msg.message) {
                    msg = `JS Error: ${msg.message}`;
                } else {
                    msg = JSON.stringify(msg, null, 2);
                }
            }

            content.innerHTML = msg;
            content.className = isError ? "text-xs font-mono p-3 bg-slate-900 text-red-400 rounded break-words whitespace-pre-wrap" : "text-xs font-mono p-3 bg-slate-900 text-green-400 rounded break-words whitespace-pre-wrap";
        }

        // 1. Load Libraries (‡πÅ‡∏ö‡∏ö Force Load)
        function gapiLoaded() {
            gapi.load('client', async () => {
                try {
                    document.getElementById('libStatus').innerHTML = '‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á Init GAPI...';
                    await gapi.client.init({ apiKey: API_KEY });
                    
                    document.getElementById('libStatus').innerHTML = '‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î Drive Library...';
                    // üî• ‡∏à‡∏∏‡∏î‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç: ‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡πÇ‡∏´‡∏•‡∏î library ‡∏ï‡∏£‡∏á‡πÜ ‡πÑ‡∏°‡πà‡∏ú‡πà‡∏≤‡∏ô discoveryDocs
                    await gapi.client.load('drive', 'v3');
                    
                    document.getElementById('libStatus').innerHTML = '‚úÖ Google Drive Library ‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå!';
                    document.getElementById('libStatus').className = 'text-sm text-green-600 font-bold';
                    
                    checkEnableAuth();
                } catch (err) {
                    document.getElementById('libStatus').innerHTML = '‚ùå ‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à (‡∏î‡∏π‡∏Ç‡πâ‡∏≤‡∏á‡∏•‡πà‡∏≤‡∏á)';
                    log(err, true);
                }
            });
        }

        function gisLoaded() {
            try {
                tokenClient = google.accounts.oauth2.initTokenClient({
                    client_id: CLIENT_ID,
                    scope: 'https://www.googleapis.com/auth/drive.readonly',
                    callback: (resp) => {
                        if (resp.error) {
                            log(resp, true);
                            return;
                        }
                        document.getElementById('authStatus').textContent = '‚úÖ ‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à (Access Token ‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡πÅ‡∏•‡πâ‡∏ß)';
                        document.getElementById('authStatus').classList.remove('hidden');
                        
                        const btn = document.getElementById('apiBtn');
                        btn.disabled = false;
                        btn.classList.remove('bg-gray-400', 'cursor-not-allowed');
                        btn.classList.add('bg-green-600', 'hover:bg-green-700');
                        btn.textContent = '‡∏Å‡∏î‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏∂‡∏á‡πÑ‡∏ü‡∏•‡πå 1 ‡πÑ‡∏ü‡∏•‡πå';
                    },
                });
                checkEnableAuth();
            } catch (err) {
                log('GIS Load Error: ' + err.message, true);
            }
        }

        function checkEnableAuth() {
            // ‡∏õ‡∏∏‡πà‡∏° Login ‡∏à‡∏∞‡∏Å‡∏î‡πÑ‡∏î‡πâ‡∏Å‡πá‡∏ï‡πà‡∏≠‡πÄ‡∏°‡∏∑‡πà‡∏≠ Library ‡πÇ‡∏´‡∏•‡∏î‡∏Ñ‡∏£‡∏ö‡∏ó‡∏±‡πâ‡∏á 2 ‡∏ï‡∏±‡∏ß‡πÅ‡∏•‡πâ‡∏ß‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô
            if (gapi.client && gapi.client.drive && tokenClient) {
                const btn = document.getElementById('authBtn');
                btn.disabled = false;
                btn.textContent = '‡∏Å‡∏î‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô';
            }
        }

        document.getElementById('authBtn').onclick = () => tokenClient.requestAccessToken({prompt: 'consent'});

        document.getElementById('apiBtn').onclick = async () => {
            log('‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏Ç‡∏≠‡πÑ‡∏õ‡∏¢‡∏±‡∏á Google Drive...');
            try {
                // ‡πÄ‡∏ä‡πá‡∏Ñ‡∏≠‡∏µ‡∏Å‡∏ó‡∏µ‡∏ß‡πà‡∏≤‡∏°‡∏µ‡∏Ç‡∏≠‡∏á‡πÑ‡∏´‡∏°
                if (!gapi.client.drive) {
                    throw new Error("‡∏´‡∏≤ gapi.client.drive ‡πÑ‡∏°‡πà‡πÄ‡∏à‡∏≠ (Library ‡∏¢‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏°‡πà‡πÄ‡∏™‡∏£‡πá‡∏à)");
                }

                const response = await gapi.client.drive.files.list({
                    'pageSize': 1,
                    'fields': 'files(id, name)',
                });
                log(`üéâ ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! ‡∏û‡∏ö‡πÑ‡∏ü‡∏•‡πå: ${response.result.files.length} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£\n‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á: ${response.result.files[0]?.name || '‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÑ‡∏ü‡∏•‡πå'}`);
            } catch (err) {
                console.error("Full Error Object:", err); 
                log(err, true);
            }
        };
    </script>
</body>
</html>


