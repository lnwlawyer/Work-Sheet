<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏°‡∏∑‡∏≠‡∏ï‡∏£‡∏ß‡∏à‡∏ã‡πà‡∏≠‡∏° API</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;600&display=swap" rel="stylesheet">
    <style> body { font-family: 'Sarabun', sans-serif; } </style>
</head>
<body class="bg-gray-100 p-4">

    <div class="max-w-md mx-auto bg-white rounded-lg shadow-lg overflow-hidden">
        <div class="bg-blue-600 p-4 text-white">
            <h1 class="text-xl font-bold">üöë ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏°‡∏∑‡∏≠‡∏ï‡∏£‡∏ß‡∏à‡∏ã‡πà‡∏≠‡∏° (Diagnostics)</h1>
            <p class="text-sm opacity-80">‡πÉ‡∏ä‡πâ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏´‡∏≤‡∏™‡∏≤‡πÄ‡∏´‡∏ï‡∏∏ Error</p>
        </div>

        <div class="p-6 space-y-4">
            
            <!-- Step 1: Config Check -->
            <div class="border-b pb-4">
                <h3 class="font-bold text-gray-700 mb-2">1. ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ñ‡πà‡∏≤‡∏ï‡∏±‡πâ‡∏á‡∏ï‡πâ‡∏ô</h3>
                <div id="configStatus" class="text-sm text-gray-500">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏£‡∏≠...</div>
            </div>

            <!-- Step 2: Auth -->
            <div class="border-b pb-4">
                <h3 class="font-bold text-gray-700 mb-2">2. ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô</h3>
                <button id="authBtn" class="bg-blue-600 text-white px-4 py-2 rounded shadow hover:bg-blue-700 w-full mb-2">
                    ‡∏Å‡∏î‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô (Authorize)
                </button>
                <div id="authStatus" class="text-sm p-2 bg-gray-50 rounded hidden"></div>
            </div>

            <!-- Step 3: API Call -->
            <div>
                <h3 class="font-bold text-gray-700 mb-2">3. ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (API)</h3>
                <button id="apiBtn" class="bg-green-600 text-white px-4 py-2 rounded shadow hover:bg-green-700 w-full mb-2" disabled>
                    ‡∏Å‡∏î‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏∂‡∏á‡πÑ‡∏ü‡∏•‡πå 1 ‡πÑ‡∏ü‡∏•‡πå
                </button>
                <!-- ‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡πÅ‡∏™‡∏î‡∏á Error ‡∏Ç‡∏≠‡∏á‡∏à‡∏£‡∏¥‡∏á -->
                <div id="errorBox" class="text-xs font-mono p-3 bg-black text-red-400 rounded mt-2 hidden break-all"></div>
                <div id="successBox" class="text-xs p-3 bg-green-50 text-green-700 rounded mt-2 hidden"></div>
            </div>

        </div>
    </div>

    <!-- Scripts -->
    <script async defer src="https://apis.google.com/js/api.js" onload="gapiLoaded()"></script>
    <script async defer src="https://accounts.google.com/gsi/client" onload="gisLoaded()"></script>

    <script>
        // ==========================================
        // ‚ö†Ô∏è ‡πÉ‡∏™‡πà‡∏£‡∏´‡∏±‡∏™‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡∏±‡∏ß‡∏£‡πå ‚ö†Ô∏è
        // ==========================================
        const CLIENT_ID = '395031237674-6j28i27or4lk6t3m342srbefukr1fp1d.apps.googleusercontent.com';
        const API_KEY = 'AIzaSyANFH1JUJ8Y29ImxTYwBdSV6V7-xWfHd90'; 
        // ==========================================

        let tokenClient;
        let accessToken = null;

        // Helper to show logs
        function log(elementId, msg, isError = false) {
            const el = document.getElementById(elementId);
            el.classList.remove('hidden');
            el.innerHTML = msg; // Allow HTML
            if(isError) el.classList.add('border', 'border-red-500');
        }

        // 1. Check Config on Load
        window.onload = () => {
            const statusDiv = document.getElementById('configStatus');
            if(CLIENT_ID.length < 10 || API_KEY.length < 10) {
                statusDiv.innerHTML = '<span class="text-red-500">‚ùå ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÉ‡∏™‡πà Client ID ‡∏´‡∏£‡∏∑‡∏≠ API Key</span>';
            } else {
                statusDiv.innerHTML = '<span class="text-green-600">‚úÖ ‡∏û‡∏ö‡∏£‡∏´‡∏±‡∏™ Config ‡πÅ‡∏•‡πâ‡∏ß</span>';
            }
        };

        // 2. Load Libraries
        function gapiLoaded() {
            gapi.load('client', async () => {
                try {
                    await gapi.client.init({
                        apiKey: API_KEY,
                        discoveryDocs: ['https://www.googleapis.com/discovery/v1/apis/drive/v3/rest'],
                    });
                    console.log('GAPI Initialized');
                } catch (err) {
                    log('errorBox', 'üî• GAPI Init Error: ' + JSON.stringify(err), true);
                }
            });
        }

        function gisLoaded() {
            tokenClient = google.accounts.oauth2.initTokenClient({
                client_id: CLIENT_ID,
                scope: 'https://www.googleapis.com/auth/drive.readonly',
                callback: (resp) => {
                    if (resp.error) {
                        log('authStatus', '‚ùå Auth Error: ' + JSON.stringify(resp), true);
                        return;
                    }
                    accessToken = resp.access_token;
                    log('authStatus', '‚úÖ ‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! (Token received)', false);
                    document.getElementById('apiBtn').disabled = false;
                    document.getElementById('authBtn').classList.add('opacity-50');
                },
            });
        }

        document.getElementById('authBtn').onclick = () => {
            if(!tokenClient) { alert('Google Library ‡∏¢‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏°‡πà‡πÄ‡∏™‡∏£‡πá‡∏à'); return; }
            tokenClient.requestAccessToken({prompt: 'consent'});
        };

        // 3. Test API Call
        document.getElementById('apiBtn').onclick = async () => {
            const errBox = document.getElementById('errorBox');
            const successBox = document.getElementById('successBox');
            errBox.classList.add('hidden');
            successBox.classList.add('hidden');
            
            successBox.textContent = '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠...';
            successBox.classList.remove('hidden');

            try {
                // Try to list just 1 file from anywhere (No folder restriction)
                const response = await gapi.client.drive.files.list({
                    'pageSize': 1,
                    'fields': 'files(id, name)',
                });

                const files = response.result.files;
                successBox.innerHTML = `üéâ <strong>‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!</strong> ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÑ‡∏î‡πâ‡πÅ‡∏•‡πâ‡∏ß<br>‡∏û‡∏ö‡πÑ‡∏ü‡∏•‡πå‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á: ${files.length > 0 ? files[0].name : '‡πÑ‡∏°‡πà‡∏û‡∏ö‡πÑ‡∏ü‡∏•‡πå (‡πÅ‡∏ï‡πà‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÑ‡∏î‡πâ)'}`;
                successBox.className = "text-xs p-3 bg-green-100 text-green-800 rounded mt-2 border border-green-200";

            } catch (err) {
                successBox.classList.add('hidden');
                
                // üïµÔ∏è ‡πÅ‡∏Å‡∏∞ Error ‡∏Ç‡∏≠‡∏á‡∏à‡∏£‡∏¥‡∏á‡∏≠‡∏≠‡∏Å‡∏°‡∏≤‡πÇ‡∏ä‡∏ß‡πå
                console.error(err);
                
                let errorMsg = "Unknown Error";
                if (err.result && err.result.error) {
                    errorMsg = `Code: ${err.result.error.code}<br>Message: ${err.result.error.message}`;
                    
                    // ‡πÅ‡∏õ‡∏•‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏°‡∏≤‡∏¢ Error ‡∏¢‡∏≠‡∏î‡∏Æ‡∏¥‡∏ï
                    if(err.result.error.code == 403) {
                        errorMsg += `<br><br>üëâ <strong>‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå:</strong> ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡∏ñ‡∏π‡∏Å‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò (‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö API Key Restrictions ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏õ‡∏¥‡∏î Drive API)`;
                    }
                    if(err.result.error.message.includes('origin')) {
                        errorMsg += `<br><br>üëâ <strong>‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå:</strong> URL ‡πÄ‡∏ß‡πá‡∏ö‡πÑ‡∏°‡πà‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö‡∏ó‡∏µ‡πà‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡πÑ‡∏ß‡πâ`;
                    }
                } else {
                    errorMsg = JSON.stringify(err);
                }

                log('errorBox', `üî• <strong>API ERROR:</strong><br>${errorMsg}`, true);
            }
        };
    </script>
</body>
</html>


